{% extends 'base.html' %}

{% block header %}
<div class="flex items-center gap-2">
    <a href="{% url 'dashboard' %}" class="text-gray-400 hover:text-gray-600"><i class="fas fa-arrow-left"></i></a>
    <span>History: {{ page.title }}</span>
</div>
{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow p-6">
    <div class="mb-4 bg-blue-50 border-l-4 border-blue-500 p-4 text-blue-700">
        <p class="font-bold">Multi-Version Compare:</p>
        <p class="text-sm">Select 2 or more versions to compare side-by-side.</p>
    </div>

    <div class="space-y-4">
        {% for v in versions %}
        <div class="flex items-start p-4 border rounded-lg hover:bg-gray-50 transition relative group">
            <div class="flex items-center h-full mr-4">
                <input type="checkbox" class="v-check w-5 h-5 text-blue-600 rounded" value="{{ v.id }}">
            </div>
            <div class="flex-1">
                <h4 class="font-bold text-gray-700">Version #{{ v.id }}</h4>
                <div class="text-sm text-gray-500">{{ v.created_at }} - By {{ v.created_by.username }}</div>
                <div class="mt-1 text-sm bg-gray-100 p-2 rounded text-gray-600 font-mono line-clamp-1">{{ v.content }}</div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="fixed bottom-8 right-8">
        <button onclick="compare()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-full shadow-lg">
            COMPARE SELECTED
        </button>
    </div>
</div>

<script>
function compare() {
    let boxes = document.querySelectorAll('.v-check:checked');
    if (boxes.length < 2) {
        return alert("Please select at least 2 versions!");
    }
    let ids = [];
    boxes.forEach(box => ids.push(box.value));
    
    // THIS GENERATES THE CORRECT URL
    window.location.href = `/compare/?ids=${ids.join(',')}`;
}
</script>
{% endblock %}